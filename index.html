<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Shift Management – Weekly Scheduler</title>
    <!-- SheetJS for Excel/CSV parsing -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <h1>Shift Management – Weekly Scheduler</h1>
      <p>Generate weekly Morning, Day, and Night shift assignments using a fair random algorithm.</p>
    </header>

    <main>
      <section class="staff-manager">
        <h2>Staff Manager</h2>
        <div class="field inline">
          <label for="newStaffName">Name</label>
          <input id="newStaffName" type="text" placeholder="Enter staff name" />
          <label for="newStaffEmail">Email</label>
          <input id="newStaffEmail" type="email" placeholder="name@example.com" />
          <button id="addStaffBtn">Add Staff</button>
        </div>
        <div class="field">
          <div class="days-grid">
            <label>Mark Unavailable Days</label>
            <div class="days">
              <label><input type="checkbox" class="dayChk" value="Mon" /> Mon</label>
              <label><input type="checkbox" class="dayChk" value="Tue" /> Tue</label>
              <label><input type="checkbox" class="dayChk" value="Wed" /> Wed</label>
              <label><input type="checkbox" class="dayChk" value="Thu" /> Thu</label>
              <label><input type="checkbox" class="dayChk" value="Fri" /> Fri</label>
              <label><input type="checkbox" class="dayChk" value="Sat" /> Sat</label>
              <label><input type="checkbox" class="dayChk" value="Sun" /> Sun</label>
            </div>
          </div>
        </div>
        <div class="field">
          <div class="staff-list-header">
            <span class="meta">Managed Staff</span>
            <button id="clearStaffBtn" class="secondary">Clear All</button>
          </div>
          <div id="staffList" class="staff-list" aria-live="polite"></div>
        </div>
      </section>
      <section class="config">
        <h2>Emergency Leave</h2>
        <div class="field inline">
          <label for="emgStaff">Staff</label>
          <select id="emgStaff"></select>
          <label for="emgDay">Day</label>
          <select id="emgDay">
            <option>Mon</option>
            <option>Tue</option>
            <option>Wed</option>
            <option>Thu</option>
            <option>Fri</option>
            <option>Sat</option>
            <option>Sun</option>
          </select>
          <button id="applyEmergencyBtn">Apply Emergency Leave & Regenerate</button>
        </div>
        <div class="field">
          <div class="staff-list-header">
            <span class="meta">Recorded Emergency Leaves</span>
            <button id="clearEmergencyBtn" class="secondary">Clear All</button>
          </div>
          <div id="emergencyList" class="staff-list" aria-live="polite"></div>
        </div>
      </section>
      <section class="config">
        <div class="field">
          <label for="fileInput">Import staff from Excel/CSV (optional)</label>
          <input id="fileInput" type="file" accept=".xlsx,.xls,.csv" />
          <div id="importMeta" class="meta" hidden>
            Imported: <span id="importCount">0</span> staff. Columns detected: <span id="importCols">–</span>.
          </div>
          <div class="meta">
            Expected columns: <code>Name</code> (required), <code>UnavailableDays</code> (optional, e.g. Mon,Wed,Fri), <code>StaffPerShift</code> (optional).
          </div>
        </div>
        <div class="field">
          <label for="staffNames">Staff names (one per line)</label>
          <textarea id="staffNames" rows="10" placeholder="Alice\nBob\nCharlie\nDavid\nEve\nFrank\nGrace\nHeidi\nIvan\nJudy"></textarea>
        </div>

        <div class="field inline">
          <label for="staffPerShift">Staff per shift</label>
          <input type="number" id="staffPerShift" min="1" value="2" />
        </div>

        <div class="field inline">
          <label>Shift hours</label>
          <div class="shift-hours">
            <label for="hoursMorning">Morning</label>
            <input type="number" id="hoursMorning" min="1" value="8" />
            <label for="hoursDay">Day</label>
            <input type="number" id="hoursDay" min="1" value="8" />
            <label for="hoursNight">Night</label>
            <input type="number" id="hoursNight" min="1" value="8" />
          </div>
        </div>

        <div class="actions">
          <button id="generateBtn">Generate Schedule</button>
          <button id="nextWeekBtn" title="Regenerate with rotation bias">Regenerate for Next Week</button>
          <button id="clearBtn" class="secondary">Clear</button>
        </div>

        <div id="errorBox" class="error" hidden></div>
      </section>

      <section id="scheduleSection" class="schedule" hidden>
        <div class="schedule-header">
          <h2>Weekly Schedule</h2>
          <a id="exportCsv" class="link" href="#" download="shift_weekly_schedule.csv">Export CSV</a>
        </div>
        <div id="scheduleContainer"></div>
      </section>

      <section id="workStatsSection" class="schedule" hidden>
        <div class="schedule-header">
          <h2>Work Summary</h2>
          <a id="exportStatsCsv" class="link" href="#" download="shift_work_summary.csv">Export CSV</a>
        </div>
        <div id="workStatsContainer"></div>
      </section>

      <section id="offDaysSection" class="schedule" hidden>
        <div class="schedule-header">
          <h2>Weekly Offs</h2>
          <a id="exportOffCsv" class="link" href="#" download="shift_weekly_offs.csv">Export CSV</a>
        </div>
        <div id="offDaysContainer"></div>
      </section>

      <section id="notificationsSection" class="schedule" hidden>
        <div class="schedule-header">
          <h2>Notifications</h2>
          <a id="exportNotificationsCsv" class="link" href="#" download="shift_notifications.csv">Export CSV</a>
        </div>
        <div class="field">
          <label>EmailJS (optional)</label>
          <div class="field inline">
            <input id="emailJsServiceId" type="text" placeholder="service_id" />
            <input id="emailJsTemplateId" type="text" placeholder="template_id" />
            <input id="emailJsPublicKey" type="text" placeholder="public_key" />
            <button id="saveEmailJsBtn" class="secondary">Save</button>
          </div>
          <div class="meta">If configured, clicking "Send All" will send emails via EmailJS. Otherwise, use mailto links.</div>
        </div>
        <div class="actions">
          <button id="sendAllBtn">Send All</button>
        </div>
        <div id="notificationsContainer"></div>
      </section>
    </main>

    <!-- EmailJS (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <footer>
      <small>
        Built for weekly planning. Random assignment with fairness constraints and rotation across weeks.
      </small>
    </footer>

    <script src="app.js"></script>
  </body>
</html>